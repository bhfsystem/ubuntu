---
- name: Get the fogg hostname
  command: fogg hostname
  register: fogg_hostname
  when: hostname is not defined and virtualization_type != "docker"
- name: Set hostname fact using fogg
  set_fact:
    hostname: "{{ fogg_hostname.stdout }}"
  when: hostname is not defined and virtualization_type != "docker"
- name: Add /etc/hosts entry
  lineinfile: >
    dest=/etc/hosts 
    regexp="^127\.0\.1\.1" 
    state=present 
    line="127.0.1.1 {{hostname}}"
  become: yes
  when: hostname is defined and hostname != ""

- name: Set /etc/hostname
  template: >
    src=hostname.j2
    dest=/etc/hostname
    owner=root
    group=root
    mode=0644
  become: yes
  when: hostname is defined and hostname != ""

- name: Rename host
  hostname: name={{ hostname }} 
  become: yes
  when: hostname is defined and hostname != ""

- name: Reset Blockfile.lock
  command: chdir="{{ansible_env.HOME}}" git checkout Blockfile.lock

- name: Get ssh-agent status
  command: ssh-add -l
  register: ssh_agent
  ignore_errors: yes

- name: Updating ubuntu block
  command: chdir="{{ansible_env.HOME}}" git pull
  when: ssh_agent.rc == 0

- name: Get new submodules
  command: chdir="{{ansible_env.HOME}}" git submodule update --init
  when: ssh_agent.rc == 0

- name: Sync dependencies
  command: chdir="{{ansible_env.HOME}}" bin/home make sync
  when: ssh_agent.rc == 0

- name: Generate .bashrc.cache
  command: chdir="{{ansible_env.HOME}}" bin/home make cache
