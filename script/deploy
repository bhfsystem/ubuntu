#!/usr/bin/env bash

function main {
  set -x
  "$@" -o StrictHostKeychecking=no -- ssh -o StrictHostKeyChecking=no github.com
  #"$@" sudo install -d -o ubuntu -d ubuntu /data
  #"$@" sudo install -d -o ubuntu -d ubuntu /config
  #"$@" mkdir /data/{cache,git}
  #rsync -ia /data/git/pkgsrc-mirror.tar.gz "$remote":/data/git/
  #rsync -ia /data/cache/{packages,curl} "$remote":/data/cache/
  "$@" -A git clone git@github.com:imma/imma-config /config
  "$@" -A git clone git@github.com:imma/ubuntu-home
  "$@" mv ubuntu-home/.git .
  "$@" rm -rf ubuntu-home
  "$@"  git reset --hard
  "$@" -A script/cibuild
  "$@" make cache
  "$@" home disable cache
  "$@" -A script/cibuild
  "$@" home enable cache
  "$@" make cache
}

main "$@"
